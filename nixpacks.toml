[phases.setup]
nixPkgs = [
    "python312",
    "pango",
    "gobject-introspection",
    "glib",
    "fontconfig",
    "cairo",
    "harfbuzz",
    "openjdk17",
    "postgresql_16",
    "gcc"
]

[phases.install]
cmds = [
    "python -m venv .venv",
    ".venv/bin/pip install --upgrade pip",
    ".venv/bin/pip install -r requirements.txt"
]

[phases.build]
# Forzamos el uso del python del entorno virtual para el comando de Django
cmds = [
    ".venv/bin/python manage.py collectstatic --noinput"
]

[variables]
PYTHONUNBUFFERED = "1"
# Estas rutas permiten que Python encuentre las librer√≠as de sistema para los PDFs
LD_LIBRARY_PATH = "/usr/lib:/usr/local/lib:/nix/store:$LD_LIBRARY_PATH"
PYTHONPATH = "/app"
# Agregamos el venv al PATH para que los comandos de terminal funcionen mejor
PATH = "/app/.venv/bin:$PATH"

[start]
cmd = ".venv/bin/gunicorn config.wsgi"